<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

*   [getAvailableThemes][1]
*   [getCurrentTheme][2]
*   [switchTheme][3]
    *   [Parameters][4]
*   [applyTheme][5]
*   [saveThemePreference][6]
*   [loadThemePreference][7]
*   [loadTranslations][8]
    *   [Parameters][9]
*   [loadLanguagePreference][10]
*   [showTranslationWarning][11]
    *   [Parameters][12]
*   [initializeTranslations][13]
*   [getText][14]
    *   [Parameters][15]
*   [toggle][16]
*   [clear][17]
*   [setImage][18]
    *   [Parameters][19]
*   [setPosition][20]
    *   [Parameters][21]
*   [processImageIntoChunks][22]
*   [getTilePixelColor][23]
    *   [Parameters][24]
*   [setTurnstileToken][25]
    *   [Parameters][26]
*   [isTokenValid][27]
*   [invalidateToken][28]
*   [ensureToken][29]
    *   [Parameters][30]
*   [handleCaptchaWithRetry][31]
*   [handleCaptchaFallback][32]
*   [inject][33]
    *   [Parameters][34]
*   [detectLanguage][35]
*   [sleep][36]
    *   [Parameters][37]
*   [waitForSelector][38]
    *   [Parameters][39]
*   [loadTurnstile][40]
*   [generatePaintToken][41]
    *   [Parameters][42]
*   [detectSitekey][43]
    *   [Parameters][44]
*   [t][45]
    *   [Parameters][46]
*   [showAlert][47]
    *   [Parameters][48]
*   [colorDistance][49]
    *   [Parameters][50]
*   [\_rgbToLab][51]
    *   [Parameters][52]
*   [\_lab][53]
    *   [Parameters][54]
*   [findClosestPaletteColor][55]
    *   [Parameters][56]
*   [formatTime][57]
    *   [Parameters][58]
*   [calculateEstimatedTime][59]
    *   [Parameters][60]
*   [findClosestColor][61]
    *   [Parameters][62]
*   [updateActiveColorPalette][63]
*   [toggleAllColors][64]
    *   [Parameters][65]
*   [unselectAllPaidColors][66]
*   [initializeColorPalette][67]
    *   [Parameters][68]
*   [populateColors][69]
    *   [Parameters][70]
*   [handleCaptcha][71]
*   [createUI][72]
*   [makeDraggable][73]
    *   [Parameters][74]
*   [dragMouseDown][75]
    *   [Parameters][76]

## getAvailableThemes

Get list of available theme names.

Returns **[Array][77]<[string][78]>** Array of theme names

## getCurrentTheme

Get the current active theme name.

Returns **[string][78]** Current theme name

## switchTheme

Switch to a different theme and update UI.

### Parameters

*   `themeName` **[string][78]** Name of the theme to switch to

## applyTheme

Apply the current theme CSS to the document.

## saveThemePreference

Save current theme preference to localStorage.

## loadThemePreference

Load saved theme preference from localStorage.

## loadTranslations

Load translations for a specific language from embedded assets.

### Parameters

*   `language` **[string][78]** Language code (e.g., 'en', 'ru', 'pt')

Returns **[Promise][79]<([Object][80] | null)>** Translation object or null if not found

## loadLanguagePreference

Load and set language preference from localStorage or browser locale.

Returns **[Promise][79]\<void>** Promise that resolves when language is loaded

## showTranslationWarning

Show a temporary warning notification for translation issues.

### Parameters

*   `message` **[string][78]** Warning message to display

## initializeTranslations

Initialize the translation system by loading English fallback and user's language preference.

Returns **[Promise][79]\<void>** Promise that resolves when translations are initialized

## getText

Safe translation function with multiple fallback levels.

### Parameters

*   `key` **[string][78]** Translation key to look up
*   `replacements` **[Object][80]** Object with placeholder replacements (optional, default `{}`)

Returns **[string][78]** Translated text with replacements applied

## toggle

Toggle the overlay on/off state.

Returns **[boolean][81]** New enabled state

## clear

Clear all overlay data and disable the overlay.

## setImage

Set the overlay image and trigger processing if position is available.

### Parameters

*   `imageBitmap` **ImageBitmap** The image to overlay on the canvas

Returns **[Promise][79]\<void>** Promise that resolves when image is set and processed

## setPosition

Set the overlay position and trigger processing if image is available.

### Parameters

*   `startPosition` **[Object][80]** Starting pixel coordinates {x, y}
*   `region` **[Object][80]** Region coordinates {x, y}

Returns **[Promise][79]\<void>** Promise that resolves when position is set and processed

## processImageIntoChunks

Process the overlay image into chunked tiles for efficient rendering.
Uses caching to avoid reprocessing unchanged images.

Returns **[Promise][79]\<void>** Promise that resolves when image processing is complete

## getTilePixelColor

Get the color of a specific pixel from a cached tile.

### Parameters

*   `tileX` **[number][82]** Tile X coordinate in region space
*   `tileY` **[number][82]** Tile Y coordinate in region space
*   `pixelX` **[number][82]** Pixel X coordinate within the tile
*   `pixelY` **[number][82]** Pixel Y coordinate within the tile

Returns **[Promise][79]<([Array][77]<[number][82]> | null)>** RGBA color array \[r,g,b,a] or null if transparent/unavailable

## setTurnstileToken

Set the Turnstile token and resolve any pending token promises.

### Parameters

*   `token` **[string][78]** The Turnstile token to set

## isTokenValid

Check if the current Turnstile token is valid and not expired.

Returns **[boolean][81]** True if token is valid and not expired

## invalidateToken

Invalidate the current Turnstile token, forcing a new one to be generated.

## ensureToken

Ensure a valid Turnstile token is available, generating one if needed.

### Parameters

*   `forceRefresh` **[boolean][81]** Force generation of a new token even if current one is valid (optional, default `false`)

Returns **[Promise][79]<([string][78] | null)>** Promise resolving to the token or null on failure

## handleCaptchaWithRetry

Generate a Turnstile token with detailed timing and error logging.

*   Throws **[Error][83]** If token generation fails

Returns **[Promise][79]<[string][78]>** Promise resolving to the generated token

## handleCaptchaFallback

Fallback token generation method when primary Turnstile method fails.

Returns **[Promise][79]<([string][78] | null)>** Promise resolving to fallback token or null

## inject

Inject code into the page context by creating a script element.

### Parameters

*   `callback` **[Function][84]** Function to inject and execute

## detectLanguage

Detect user's language preference from WPlace backend or browser locale.

Returns **[Promise][79]\<void>** Promise that resolves when language is detected and set

## sleep

Sleep/pause execution for specified milliseconds.

### Parameters

*   `ms` **[number][82]** Milliseconds to sleep

Returns **[Promise][79]\<void>** Promise that resolves after the specified delay

## waitForSelector

Wait for a DOM element to appear with configurable timeout.

### Parameters

*   `selector` **[string][78]** CSS selector to wait for
*   `interval` **[number][82]** Polling interval in milliseconds (optional, default `200`)
*   `timeout` **[number][82]** Maximum wait time in milliseconds (optional, default `5000`)

Returns **[Promise][79]<([Element][85] | null)>** The found element or null if timeout

## loadTurnstile

Load Cloudflare Turnstile CAPTCHA library if not already loaded.

Returns **[Promise][79]\<void>** Promise that resolves when Turnstile is ready

## generatePaintToken

Generate a Turnstile token for painting operations.

### Parameters

*   `sitekey` **[string][78]** Cloudflare sitekey for Turnstile verification

Returns **[Promise][79]<([string][78] | null)>** Promise resolving to the generated token or null on failure

## detectSitekey

Detect the Cloudflare Turnstile sitekey from the current page.

### Parameters

*   `fallback` **[string][78]** Fallback sitekey if detection fails (optional, default `'0x4AAAAAABpqJe8FO0N84q0F'`)

Returns **[string][78]** The detected or fallback sitekey

## t

Synchronous translation function for UI rendering with parameter substitution.

### Parameters

*   `key` **[string][78]** Translation key to look up
*   `params` **[Object][80]** Parameters to substitute in the translation string (optional, default `{}`)

Returns **[string][78]** Translated and parameterized text, or the key if not found

## showAlert

Display a temporary alert notification to the user.

### Parameters

*   `message` **[string][78]** The message to display
*   `type` **[string][78]** Alert type: 'info', 'success', 'warning', or 'error' (optional, default `'info'`)

## colorDistance

Calculate Euclidean distance between two RGB colors.

### Parameters

*   `a` **[Array][77]<[number][82]>** First RGB color as \[r, g, b]
*   `b` **[Array][77]<[number][82]>** Second RGB color as \[r, g, b]

Returns **[number][82]** Distance between the colors

## \_rgbToLab

Convert RGB color to CIE LAB color space for perceptual color matching.

### Parameters

*   `r` **[number][82]** Red channel (0-255)
*   `g` **[number][82]** Green channel (0-255)
*   `b` **[number][82]** Blue channel (0-255)

Returns **[Array][77]<[number][82]>** LAB color as \[L, a, b] where L is lightness, a and b are color-opponent dimensions

## \_lab

Get LAB color values with caching for performance optimization.

### Parameters

*   `r` **[number][82]** Red channel (0-255)
*   `g` **[number][82]** Green channel (0-255)
*   `b` **[number][82]** Blue channel (0-255)

Returns **[Array][77]<[number][82]>** Cached LAB color as \[L, a, b]

## findClosestPaletteColor

Find the perceptually closest color from the available palette.
Uses LAB color space for accurate perceptual distance calculation.

### Parameters

*   `r` **[number][82]** Red channel (0-255) of target color
*   `g` **[number][82]** Green channel (0-255) of target color
*   `b` **[number][82]** Blue channel (0-255) of target color
*   `palette` **[Array][77]<[Array][77]<[number][82]>>?** Array of RGB triplets \[\[r,g,b], ...]. Uses CONFIG.COLOR\_MAP if not provided

Returns **[Array][77]<[number][82]>** The closest palette color as \[r, g, b] RGB triplet

## formatTime

Format milliseconds into human-readable time string.

### Parameters

*   `ms` **[number][82]** Time in milliseconds

Returns **[string][78]** Formatted time string (e.g., "2h 30m 15s" or "45s")

## calculateEstimatedTime

Calculate estimated completion time based on remaining pixels and charges.

### Parameters

*   `remainingPixels` **[number][82]** Number of pixels left to paint
*   `charges` **[number][82]** Available charges
*   `cooldown` **[number][82]** Cooldown time per charge in milliseconds

Returns **[number][82]** Estimated time in milliseconds

## findClosestColor

Find the closest available color ID for a target RGB color using caching.

### Parameters

*   `targetRgb` **[Array][77]<[number][82]>** Target RGB color as \[r, g, b]
*   `availableColors` **[Array][77]<[Object][80]>** Array of available color objects with id and rgb properties

Returns **[number][82]** The ID of the closest available color

## updateActiveColorPalette

Update the active color palette based on currently selected color swatches.

## toggleAllColors

Toggle all color swatches on or off, respecting availability.

### Parameters

*   `select` **[boolean][81]** Whether to select (true) or deselect (false) colors
*   `showingUnavailable` **[boolean][81]** Whether unavailable colors are currently shown (optional, default `false`)

## unselectAllPaidColors

Deselect all paid/premium colors (color IDs >= 32).

## initializeColorPalette

Initialize the color palette UI with available colors.

### Parameters

*   `container` **[Element][85]** DOM container element for the color palette

## populateColors

Populate the color palette with color swatches.

### Parameters

*   `showUnavailable` **[boolean][81]** Whether to show unavailable colors (optional, default `false`)

## handleCaptcha

Handle CAPTCHA challenges based on user's token source preference.

Returns **[Promise][79]<([string][78] | null)>** Promise resolving to the generated token or null

## createUI

Create and initialize the main user interface components.

Returns **[Promise][79]\<void>** Promise that resolves when UI is created

## makeDraggable

Make a UI element draggable by its header.

### Parameters

*   `element` **[Element][85]** The element to make draggable

## dragMouseDown

Handle mouse down event to start dragging.

### Parameters

*   `e` **[MouseEvent][86]** The mouse event

[1]: #getavailablethemes

[2]: #getcurrenttheme

[3]: #switchtheme

[4]: #parameters

[5]: #applytheme

[6]: #savethemepreference

[7]: #loadthemepreference

[8]: #loadtranslations

[9]: #parameters-1

[10]: #loadlanguagepreference

[11]: #showtranslationwarning

[12]: #parameters-2

[13]: #initializetranslations

[14]: #gettext

[15]: #parameters-3

[16]: #toggle

[17]: #clear

[18]: #setimage

[19]: #parameters-4

[20]: #setposition

[21]: #parameters-5

[22]: #processimageintochunks

[23]: #gettilepixelcolor

[24]: #parameters-6

[25]: #setturnstiletoken

[26]: #parameters-7

[27]: #istokenvalid

[28]: #invalidatetoken

[29]: #ensuretoken

[30]: #parameters-8

[31]: #handlecaptchawithretry

[32]: #handlecaptchafallback

[33]: #inject

[34]: #parameters-9

[35]: #detectlanguage

[36]: #sleep

[37]: #parameters-10

[38]: #waitforselector

[39]: #parameters-11

[40]: #loadturnstile

[41]: #generatepainttoken

[42]: #parameters-12

[43]: #detectsitekey

[44]: #parameters-13

[45]: #t

[46]: #parameters-14

[47]: #showalert

[48]: #parameters-15

[49]: #colordistance

[50]: #parameters-16

[51]: #_rgbtolab

[52]: #parameters-17

[53]: #_lab

[54]: #parameters-18

[55]: #findclosestpalettecolor

[56]: #parameters-19

[57]: #formattime

[58]: #parameters-20

[59]: #calculateestimatedtime

[60]: #parameters-21

[61]: #findclosestcolor

[62]: #parameters-22

[63]: #updateactivecolorpalette

[64]: #toggleallcolors

[65]: #parameters-23

[66]: #unselectallpaidcolors

[67]: #initializecolorpalette

[68]: #parameters-24

[69]: #populatecolors

[70]: #parameters-25

[71]: #handlecaptcha

[72]: #createui

[73]: #makedraggable

[74]: #parameters-26

[75]: #dragmousedown

[76]: #parameters-27

[77]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[78]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[79]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[80]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[81]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[82]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[83]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error

[84]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[85]: https://developer.mozilla.org/docs/Web/API/Element

[86]: https://developer.mozilla.org/docs/Web/API/MouseEvent
